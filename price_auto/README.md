## Определение стоимости автомобилей
_______________________________________________________________________________________________________________________________________________________________________________

Задача: 

Подготовить прототип модели машинного обучения.

Модель должна предсказать рыночную стоимость автомобиля.

Для этого используем исторические данные: технические характеристики, комплектации и цены автомобилей.

Работы выполнили в 4 этапа:

Подготовка данных;
Анализ данных;
Построение и обучение модели.
Выбор модели и тестирование.


Для заказчика важны следующие факторы:

качество предсказания;
скорость предсказания;
время обучения.

в этом проекте использовали 
pandas 
numpy 
matplotlib 
seaborn
sklearn.pipeline Pipeline, make_pipeline
StandardScaler, OneHotEncoder, OrdinalEncoder
ColumnTransformer, make_column_transformer
make_scorer, mean_squared_error
SimpleImputer
SelectPercentile, chi2
RandomizedSearchCV
LinearRegression
DecisionTreeRegressor
lightgbm
CatBoost

В ходе подготовки данных:

Названия колонок привели к общему виду без заглавных букв и написанию через нижнее подчеркивание.
типы данных в колонках с датами перевели к типу DataTime.
удалили повторяющиеся строки
данные слабо коррелируют, ожидаемо наибольшую взаимосвязь с целевым признаком имеют пробег мощность двигателя и год выпуска.
отделили целевую переменную с ценой, данные разбили на обучающую и тестовую выборки в соотношении 8:2

В ходе анализа данных
Расмотрев целевой параметр с ценой:

Удалили данные находящиеся за пределами 4 межквартильных растояний распределения при помощи написанной функции.
Удалили значения ниже первого пика в 100 евро для более точного обучения модели.
Рассмотрели обучающую выборку:
* Удалили из тренировочной выборки строки соответствующие удаленным значениям в таргете по индексу.
* Удалили нашей функцией экстримальные значения в признаках Год регистрации и Мощность двигателя.
* По всей видимости в сервисе значение пробега выбирается из предложенного списка, наблюдаем небольшое кол-во уникальных значений, кратных 5 000 км. Оставили данные в неизменном виде.
* На графике распределения по брендам видим больше всего анкет по volkswagen дальше расположились opel, bmw, mercedes_benz. Наименьшее кол-во анкет по таким брендам как jeep, daewoo, jaguar, lada, porsche, trabant.
* Больше всего анкет в крупных городах в них же как правило цены на авто отличаются от остальных городов. Выбрали города с кол-вом анкет больше 200. Оставили их индексы остальные заменили заглушкой будем считать что небольшие города не сильно влияют на рыночную стоимость авто. Уникальных городов с кол-вом анкет около 16 что соответсвует кол-ву наиболее крупных городов России.
* Удалили из таргета значения соответствующие удаленным строкам в тренировочной выборке
* В обучающец выборке оставили колонки характеризующие объект исследования

для построения и обучения моделей были выбраны LinearRegression, DecisionTreeRegressor, LGBMRegressor, CatBoostRegressor.

Для моделей DecisionTreeRegressor и LGBMRegressor гиперпараметры подбирали через RandomizedSearchCV. через pipeline выполнили предобработку с кодированием категориальных данных, и масштабированием числовых данных

По условию первоначальной задачи прошли все модели значение RMSE < 2500. Качественно выигрывает модель CatBoostRegressor она имеет наименьшее значение RMSE=1530 делает наиболее точные предсказания, но при этом показывает время обучения 350 секунд что гораздо больше чем у других моделей. чуть хуже всего на 50 пунктов результат показал CatBoostRegressor с estimators=500 но при этом по времени обучения почти в три раза быстрее.

Наихудшие результаты показала модель LinearRegression_RandomSearchCV

Вывод: чем больше параметров как и ожидалось тем больше времени требуется для обучения моделей, CatBoostRegressor умеет работать с категориальными признаками. estimators Выше 1500 нусущественно улучшает характеристику MRSE при этом на обучение уходит гораздо больше времени.

Для решения поставленной задачи провели тестирование на модели CatBoostRegressor_1500.

Модель выбиралась на основании трех характеристик указанных заказчиком:

качество предсказания;
скорость предсказания;
время обучения.
После подготовки тестовой выборки и приведению ее к формату тренировочной выборки модель показала на предсказаниях значение RMSE равное 1560. Выполнили проверку на адекватнойсть. Выбранная нами модель показывает результат превосходящий в три раза константную модель. Модель показала довольно стабильный высокий результат. Цели задачи проекта выполнены.
